<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Đăng ký tham gia lễ Kỷ niệm Trung Tâm</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0; padding: 0;
      background: linear-gradient(to right, #e0f7fa, #ffffff);
    }

    header {
      background: linear-gradient(to right, #2c3e50, #4ca1af);
      color: white;
      padding: 1.5rem;
      text-align: center;
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: 1px;
      user-select: none;
    }

    .container {
      max-width: 700px;
      margin: 2rem auto;
      background: #fff;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 10px 30px rgb(0 0 0 / 0.1);
      position: relative;
    }

    label {
      display: block;
      margin-top: 1.5rem;
      font-weight: 600;
      color: #34495e;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px 12px;
      margin-top: 6px;
      border-radius: 8px;
      border: 1.5px solid #ccc;
      font-size: 1rem;
      box-sizing: border-box;
      transition: border-color 0.3s;
    }

    input[type="text"]:focus {
      border-color: #3498db;
      outline: none;
      box-shadow: 0 0 8px #3498dbaa;
    }

    .suggestions-list {
      list-style: none;
      margin: 0; padding: 0;
      border: 1px solid #ccc;
      border-top: none;
      max-height: 160px;
      overflow-y: auto;
      background: #fff;
      position: absolute;
      width: calc(100% - 2rem);
      z-index: 1000;
      border-radius: 0 0 8px 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.12);
    }

    .suggestions-list li {
      padding: 10px 14px;
      cursor: pointer;
      user-select: none;
    }

    .suggestions-list li:hover {
      background-color: #f0f0f0;
    }

    .input-wrapper {
      position: relative;
      width: 100%;
    }

    .checkbox-group {
      margin-top: 2rem;
      display: flex;
      gap: 2rem;
      align-items: center;
    }

    .checkbox-group label {
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      user-select: none;
    }

    .checkbox-group input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
      border-radius: 4px;
      border: 1.5px solid #3498db;
      transition: background-color 0.3s, border-color 0.3s;
    }

    .checkbox-group input[type="checkbox"]:checked {
      background-color: #3498db;
      border-color: #2980b9;
    }

    button {
      margin-top: 2.5rem;
      padding: 14px 28px;
      font-size: 1.1rem;
      font-weight: 700;
      color: white;
      background: linear-gradient(to right, #27ae60, #2ecc71);
      border: none;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(46, 204, 113, 0.5);
      transition: background 0.3s;
      user-select: none;
      width: 100%;
    }

    button:hover {
      background: linear-gradient(to right, #2ecc71, #27ae60);
    }

    #participants {
      max-width: 900px;
      margin: 3rem auto;
      background: #fff;
      padding: 1.5rem 2rem;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgb(0 0 0 / 0.08);
    }

    #participants h2 {
      margin-top: 0;
      color: #34495e;
      font-weight: 700;
      user-select: none;
      letter-spacing: 0.5px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      font-size: 1rem;
    }

    th, td {
      padding: 14px 16px;
      border-bottom: 1px solid #ddd;
      text-align: left;
      user-select: text;
    }

    th {
      background-color: #3498db;
      color: white;
      font-weight: 700;
    }

    tr:nth-child(even) {
      background-color: #f8faff;
    }

    @media (max-width: 600px) {
      .container, #participants {
        margin: 1rem;
        padding: 1rem;
      }

      table, thead, tbody, th, td, tr {
        display: block;
      }

      td {
        padding-left: 50%;
        position: relative;
        border: none;
        border-bottom: 1px solid #eee;
      }

      td::before {
        position: absolute;
        top: 14px;
        left: 16px;
        width: 45%;
        white-space: nowrap;
        font-weight: 600;
        color: #555;
      }

      td:nth-of-type(1)::before { content: "Họ và tên"; }
      td:nth-of-type(2)::before { content: "Phòng"; }
      td:nth-of-type(3)::before { content: "Trung tâm"; }
      td:nth-of-type(4)::before { content: "Trạng thái"; }
    }
  </style>
</head>
<body>

<header>
  Đăng ký tham gia lễ Kỷ niệm Trung Tâm
</header>

<div class="container">
  <label for="fullname">Họ và tên:</label>
  <div class="input-wrapper">
    <input type="text" id="fullname" placeholder="Nhập họ và tên" autocomplete="off" />
    <ul id="name-suggestions" class="suggestions-list"></ul>
  </div>

  <label for="department">Phòng:</label>
  <div class="input-wrapper">
    <input type="text" id="department" placeholder="Nhập tên phòng (không bắt buộc)" autocomplete="off" />
    <ul id="department-suggestions" class="suggestions-list"></ul>
  </div>

  <label for="center">Trung tâm:</label>
  <div class="input-wrapper">
    <input type="text" id="center" placeholder="Trung tâm (không bắt buộc)" autocomplete="off" />
    <ul id="center-suggestions" class="suggestions-list"></ul>
  </div>

  <div class="checkbox-group">
    <label><input type="checkbox" id="participate" /> Tham gia</label>
    <label><input type="checkbox" id="notParticipate" /> Không tham gia</label>
  </div>

  <button onclick="submitForm()">Đăng ký</button>
</div>

<div id="participants">
  <h2>Danh sách tham gia</h2>
  <div style="text-align: right; margin-bottom: 1rem;">
    <button onclick="exportToExcel()" style="
      background: linear-gradient(to right, #f39c12, #f1c40f);
      color: white; border: none;
      width: 70px; padding: 6px 0;
      border-radius: 6px; cursor: pointer; font-weight: 600;
      box-shadow: 0 2px 6px rgba(241,196,15,0.4);
      font-size: 0.85rem; text-align: center;
    ">Excel</button>
  </div>
  <table>
    <thead>
      <tr>
        <th>Họ và tên</th>
        <th>Phòng</th>
        <th>Trung tâm</th>
        <th>Trạng thái</th>
      </tr>
    </thead>
    <tbody id="list-body"></tbody>
  </table>
</div>

<!-- Thư viện SheetJS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<script>
  const nameList = ["Nguyễn Văn A","Nguyễn Văn B","Trần Thị C","Lê Văn D","Phạm Thị E"];
  const departmentList = ["Phòng Kỹ thuật","Phòng Nhân sự","Phòng Kế toán","Phòng IT"];
  const centerMap = {
    "Phòng Kỹ thuật": ["Trung tâm Công nghệ", "Trung tâm Sản xuất"],
    "Phòng Nhân sự": ["Trung tâm Hành chính", "Trung tâm Đào tạo"],
    "Phòng Kế toán": ["Trung tâm Tài chính"],
    "Phòng IT": ["Trung tâm Hạ tầng", "Trung tâm Phần mềm"]
  };

  function removeVietnameseTones(str) {
    str = str.toLowerCase();
    str = str.normalize('NFD').replace(/[\u0300-\u036f]/g, "");
    str = str.replace(/đ/g, "d");
    str = str.replace(/[^a-z0-9\s]/g, "");
    return str;
  }

  function setupAutoSuggest(inputId, list, suggestionId, onSelectCallback) {
    const input = document.getElementById(inputId);
    const suggestionBox = document.getElementById(suggestionId);

    input.addEventListener("input", function () {
      const rawValue = this.value.trim();
      const value = removeVietnameseTones(rawValue);
      suggestionBox.innerHTML = "";
      if (!value) return;

      const matches = list.filter(item => removeVietnameseTones(item).includes(value));
      matches.forEach(item => {
        const li = document.createElement("li");
        li.textContent = item;
        li.addEventListener("click", () => {
          input.value = item;
          suggestionBox.innerHTML = "";
          if (onSelectCallback) onSelectCallback(item);
        });
        suggestionBox.appendChild(li);
      });
    });

    document.addEventListener("click", function (e) {
      if (!input.contains(e.target) && !suggestionBox.contains(e.target)) {
        suggestionBox.innerHTML = "";
      }
    });
  }

  setupAutoSuggest("fullname", nameList, "name-suggestions");
  setupAutoSuggest("department", departmentList, "department-suggestions", updateCenterSuggestions);

  function updateCenterSuggestions(deptName) {
    const centers = centerMap[deptName] || [];
    setupAutoSuggest("center", centers, "center-suggestions");
    document.getElementById("center").value = centers.length === 1 ? centers[0] : "";
  }

  document.getElementById("participate").addEventListener("change", function () {
    if (this.checked) document.getElementById("notParticipate").checked = false;
  });
  document.getElementById("notParticipate").addEventListener("change", function () {
    if (this.checked) document.getElementById("participate").checked = false;
  });

  const formData = [];

  function submitForm() {
    const name = document.getElementById("fullname").value.trim();
    const dept = document.getElementById("department").value.trim();
    const center = document.getElementById("center").value.trim();
    const participate = document.getElementById("participate").checked;
    const notParticipate = document.getElementById("notParticipate").checked;

    if (!name) {
      alert("Vui lòng nhập Họ và tên!");
      return;
    }
    if (!participate && !notParticipate) {
      alert("Vui lòng chọn Tham gia hoặc Không tham gia.");
      return;
    }

    formData.push({ 
      name, 
      dept, 
      center, 
      status: participate ? "Tham gia" : "Không tham gia"
    });

    updateList();
    clearForm();
  }

  function updateList() {
    const tbody = document.getElementById("list-body");
    tbody.innerHTML = "";
    formData.forEach(data => {
      const row = `<tr>
        <td>${data.name}</td>
        <td>${data.dept || "-"}</td>
        <td>${data.center || "-"}</td>
        <td>${data.status}</td>
      </tr>`;
      tbody.innerHTML += row;
    });
  }

  function clearForm() {
    document.getElementById("fullname").value = "";
    document.getElementById("department").value = "";
    document.getElementById("center").value = "";
    document.getElementById("participate").checked = false;
    document.getElementById("notParticipate").checked = false;
    document.getElementById("name-suggestions").innerHTML = "";
    document.getElementById("department-suggestions").innerHTML = "";
    document.getElementById("center-suggestions").innerHTML = "";
  }

  function exportToExcel() {
    if (formData.length === 0) {
      alert("Danh sách đang trống, không có gì để xuất.");
      return;
    }

    const worksheetData = [
      ["Họ và tên", "Phòng", "Trung tâm", "Trạng thái"],
      ...formData.map(item => [item.name, item.dept || "", item.center || "", item.status])
    ];

    const worksheet = XLSX.utils.aoa_to_sheet(worksheetData);
    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, "Danh sách");
    XLSX.writeFile(workbook, "danh_sach_tham_gia.xlsx");
  }
</script>

</body>
</html>
